# Evolver Architecture Decision Record (ADR)

"Logic is not corrected; it is evolved."

This document records the critical architectural decisions made during the transition of the Evolver project from v0.1 (Sidecar/Corrector) to the current Native Generator, Master Meow.

---

## 1. The Paradigm Shift

### ADR-001: From "Logic Correction" to "Logic Generation"

**Background:** In early designs, Evolver was conceived as a "Sidecar" used to correct erroneous logic generated by external LLMs. The workflow was: LLM -> Logits -> Bias Controller -> STP Check -> LLM.

**Problem:** This architecture relied heavily on the quality of the external model. Furthermore, the geometric meaning of the "Bias Vector" in high-dimensional logit space was ambiguous, making precise control difficult.

**Decision:** Evolver has transitioned into an independent Algebraic Logic Generation Engine. The workflow is now: Context -> Algebraic Seed -> Soul Evolution -> VAPO Optimization -> Native Path. Logic paths now "grow" directly from algebraic structures (ideal class groups) rather than being patches applied to external probability distributions.

**Impact:** The system no longer requires running massive LLMs for real-time inference (except as an optional "intuitive" guide). The correctness of logic is guaranteed by the intrinsic properties of the algebraic group and VAPO search, achieving an approximation of "Correct-by-Construction."

---

## 2. The Algebraic Core

### ADR-002: From "Matrix" to "Class Groups"

**Background:** The STP engine originally used Matrix Semi-Tensor Products to simulate logic. While matrices can verify logic, the space they form is discrete and rigid, lacking a proper concept of "neighborhood," which makes continuous or heuristic searches difficult.

**Decision:** Introduce Ideal Class Groups of Imaginary Quadratic Fields 
$$Cl(\Delta)$$
as the core state space (src/soul/algebra.rs). Logical states are encoded as elements $(a, b, c)$ within the class group. Group operations (Gauss composition) provide a rich orbital structure, giving state evolution the characteristics of deterministic chaos.

**Impact:**
* **Security:** Discrete logarithm problems based on class groups provide potential cryptographic security (Time Security).
* **Optimizability:** The class group structure allows for the definition of algebraic "perturbations," providing an actionable search space for the VAPO algorithm.

---

## 3. The Will (Optimization Strategy)

### ADR-003: From "Gradient Descent" to "VAPO (Valuation-Adaptive Perturbation Optimization)"

**Background:** The STP energy function 
$$E(s)$$
is a discrete step function where the gradient is zero almost everywhere. Attempting "Differentiable Relaxation" via Softmax led to vanishing gradients or getting trapped in local minima.

**Decision:** Adopt the VAPO algorithm (src/will/optimizer.rs). This is a discrete optimizer based on Metropolis-Hastings and greedy search.

**Core Mechanism:** Valuation-Adaptive.
* **Early Stage:** Use large-norm (large prime) perturbations for coarse-grained "Structural Jumps."
* **Late Stage:** Use small-norm (small prime) perturbations for fine-grained tuning.

**Impact:** Backpropagation has been entirely abandoned. The optimization process has become a "Random Walk + Energy Locking" on the group manifold.

---

## 4. The Body (Materialization and Output)

### ADR-004: From "Logit Bias" to "Native Path Projection"

**Background:** The old architecture influenced token selection by adding an output vector 
$$\vec{b} \in \mathbb{R}^V$$
to the Logits. This was not only computationally expensive (requiring alignment with vocabulary dimensions) but also made it difficult to ensure that "algebraic intent" was correctly translated into "linguistic tokens."

**Decision:** Introduce v-PuNN Topological Projection (src/body/). This directly projects the algebraic state 
$$S^*$$
into a sequence of discrete u64 digits. An Adapter Pattern (src/body/adapter.rs) is then used to deterministically map these digits to a ProofAction.

**Impact:**
* **Decoupling:** Evolver's output no longer depends on specific tokenizers or LLM vocabularies.
* **Determinism:** Given the same algebraic state, the generated logic path is uniquely determined.

---

## 5. Interface Design

### ADR-005: Building Python Extensions with PyO3

**Background:** Rust provides low-level performance and type safety, but the AI ecosystem (verifiers, downstream tasks) exists primarily in Python.

**Decision:** Use `pyo3` to wrap Evolver as a Python module (`new_evolver`). Expose a simple `align(context) -> path` interface.

**Impact:** Enables Evolver to integrate seamlessly into existing Python AI pipelines as a high-performance logic generation kernel.

---

## Summary

Evolver's architecture is a biologically inspired "Soul-Will-Body" system. It no longer attempts to "teach" a neural network how to perform logic; instead, it "constructs" logic directly within mathematical structures.
